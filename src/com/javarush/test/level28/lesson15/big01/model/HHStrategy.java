package com.javarush.test.level28.lesson15.big01.model;import com.javarush.test.level28.lesson15.big01.vo.Vacancy;import org.jsoup.Jsoup;import org.jsoup.nodes.Document;import org.jsoup.nodes.Element;import org.jsoup.select.Elements;import java.io.IOException;import java.util.ArrayList;import java.util.List;/** * Created by 309_newpower on 19.01.2016. */public class HHStrategy implements Strategy{    private static final String URL_FORMAT = "http://hh.ua/search/vacancy?text=java+%s&page=%d";    @Override    public List<Vacancy> getVacancies(String searchString)    {        List<Vacancy> list = new ArrayList<>();        int i = 0;        while (true)        {            Document document = getDocument(searchString, i);            Elements elements = document.select("[data-qa=\"vacancy-serp__vacancy\"]");            if (elements.size() > 0) i++;            else break;            for (Element element : elements)            {                Vacancy vacancy = new Vacancy();                vacancy.setSiteName("http://hh.ua/");                vacancy.setCity(element.select("[data-qa=\"vacancy-serp__vacancy-address\"]").text());                vacancy.setCompanyName(element.select("[data-qa=\"vacancy-serp__vacancy-employer\"]").text());                vacancy.setTitle(element.select("[data-qa=\"vacancy-serp__vacancy-title\"]").text());                vacancy.setUrl(element.select("[data-qa=\"vacancy-serp__vacancy-title\"]").attr("href"));                vacancy.setSalary(element.select("[data-qa=\"vacancy-serp__vacancy-compensation\"]").text());                list.add(vacancy);            }        }        return list;    }    protected Document getDocument(String searchString, int page)    {        Document doc = null;        try        {            doc = Jsoup.connect(String.format(URL_FORMAT, searchString, page))                    .userAgent("Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.111 Safari/537.36")                    .referrer("https://hh.ua/search/vacancy?text=java+searchString")                    .get();//            doc = Jsoup.connect("http://javarush.ru/testdata/big28data.html")//                    .userAgent("Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.111 Safari/537.36")//                    .referrer("https://hh.ua/search/vacancy?text=java+%D0%BA%D0%B8%D0%B5%D0%B2")//                    .get();        }        catch (IOException ignore) {}        return doc;    }}